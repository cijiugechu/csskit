name: Benchmark Tracking
on:
  workflow_dispatch:
  schedule:
    - cron: "0 2 * * *"
jobs:
  benchmark:
    name: Collect and Track Benchmarks
    runs-on: ubuntu-latest
    permissions:
      actions: write
      pull-requests: write
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      - name: Download benchmark history
        uses: dawidd6/action-download-artifact@0bd50d53a6d7fb5cb921e607957e9cc12b4ce392 # v12
        with:
          name: benchmark-history
          workflow: benchmark-tracking.yml
          workflow_conclusion: success
          branch: main
          search_artifacts: true
          path: website/_data
      - name: Setup mise
        uses: jdx/mise-action@v3
      - name: Setup
        uses: ./.github/actions/setup
      - name: Run benchmark collection
        run: mise run collect-benchmarks
      - name: Upload benchmark history artifact
        uses: actions/upload-artifact@b7c566a772e6b6bfb58ed0dc250532a479d7789f # v6.0.0
        with:
          name: benchmark-history
          path: website/_data/benchmark-history.json
          retention-days: 90
