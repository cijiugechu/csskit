name: Benchmark Tracking
on:
  workflow_dispatch:
  schedule:
    - cron: "0 2 * * *"
jobs:
  benchmark:
    name: Collect and Track Benchmarks
    runs-on: ubuntu-latest
    permissions:
      actions: write
      pull-requests: write
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
      - name: Download benchmark history
        uses: dawidd6/action-download-artifact@ac66b43f0e6a346234dd65d4d0c8fbb31cb316e5 # v11
        with:
          name: benchmark-history
          workflow: benchmark-tracking.yml
          workflow_conclusion: success
          branch: main
          search_artifacts: true
          path: website/_data
      - name: Setup mise
        uses: jdx/mise-action@v3
      - name: Setup
        uses: ./.github/actions/setup
      - name: Run benchmark collection
        run: mise run collect-benchmarks
      - name: Upload benchmark history artifact
        uses: actions/upload-artifact@330a01c490aca151604b8cf639adc76d48f6c5d4 # v5.0.0
        with:
          name: benchmark-history
          path: website/_data/benchmark-history.json
          retention-days: 90
