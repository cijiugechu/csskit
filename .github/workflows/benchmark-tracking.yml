name: Benchmark Tracking
on:
  workflow_dispatch:
  schedule:
    - cron: "0 2 * * *"
jobs:
  benchmark:
    name: Collect and Track Benchmarks
    runs-on: ubuntu-latest
    permissions:
      actions: write
      pull-requests: write
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
      - name: Checkout historical data
        run: git fetch origin refs/heads/website && git restore --source=origin/website website/_data/benchmark-history.json
      - name: Setup mise
        uses: jdx/mise-action@v3
      - name: Setup
        uses: ./.github/actions/setup
      - name: Run benchmark collection
        run: mise run collect-benchmarks
      - name: Upload benchmark history artifact
        uses: actions/upload-artifact@fa0a91b85d4f404e444e00e005971372dc801d16 # v4.6.2
        with:
          name: benchmark-history
          path: website/_data/benchmark-history.json
          retention-days: 90
