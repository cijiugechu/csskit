name: "Setup Environment"
description: "Common setup"
inputs:
  key:
    description: "Shared Key"
    required: false
    default: global-rust-cache
  dir:
    description: "Working directory"
    required: false
    default: ./
runs:
  using: "composite"
  steps:
    - name: Rust cache
      uses: swatinem/rust-cache@f13886b937689c021905a6b90929199931d60db1 # v2.8.1
      with:
        shared-key: ${{ inputs.key }}
    - name: Mise
      uses: jdx/mise-action@e3d7b8d67a7958d1207f6ed871e83b1ea780e7b0 # v3.3.1
      with:
        working_directory: ${{ inputs.dir }}
    - name: Ensure cargo fmt is installed
      shell: bash
      run: rustup component add rustfmt
    - name: Ensure cargo clippy is installed
      shell: bash
      run: rustup component add clippy
    - name: Double check Rust is installed
      shell: bash
      run: mise install rust && rustc --version && rustfmt --version
